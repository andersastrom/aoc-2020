import numpy as np

# Solution is not yet generic


class Day20_1:
    input = """Tile 2297:
###.###..#
.....#.#.#
......##.#
..........
##....#...
#.#...##.#
##...#..##
#...#.####
#.##.###..
####..#.##

Tile 2459:
..#.#.#..#
..###...#.
#....#.#.#
...#.#.#..
#..#.....#
###.#...##
.#....#...
##....#...
...#......
##....#.##

Tile 3547:
.#..##.##.
....####..
#....#..#.
#......#.#
...####.##
...#.#....
...##..#.#
###.###...
#....#...#
##.###...#

Tile 1741:
###.###...
#.#.#....#
#..#...###
###...##.#
.....#..#.
#........#
...#.....#
.........#
....#.#..#
#####.#.##

Tile 2237:
#....#..##
...#.....#
##.......#
.#........
......#..#
##..######
....#...##
#...#.#..#
...#......
.#.##..##.

Tile 1889:
#..###.###
#.####...#
....##.#.#
...#.#...#
..........
#...#.##.#
#..#.##.##
#...#.....
###.#..#.#
.#..#..##.

Tile 3061:
##.####...
#.##...#..
#.....##..
#.....#..#
#.....#.#.
#.#......#
.#.##....#
.#.......#
#.#.#...#.
#...#...##

Tile 1907:
#...#.###.
...#..#..#
##.###...#
#....#...#
##...#..##
.###......
.#..#..##.
#....##..#
.#....##..
.#...#####

Tile 1193:
#..##..##.
...#.....#
......#...
.#......#.
.#.##...##
..#..#...#
#.#.....##
...#.#....
#..##.....
####..##..

Tile 3733:
###.##...#
#......#..
##....#...
##..###...
##.##.###.
#........#
#....#...#
.....###..
.#......##
....##..##

Tile 1327:
#####.##.#
..#.....##
.#...#..#.
#..#..##.#
..#.......
......#...
#...#..###
##........
......#...
.###.#.###

Tile 3907:
..#..##.##
#......##.
...##....#
.........#
.###..#...
#.#.#.....
#..#.....#
.#..##.#.#
....#....#
.#.#..#.##

Tile 3019:
###......#
#...#..#.#
#..#.#....
#..#.....#
.....###..
.........#
..#.......
##.#.....#
#.....#.#.
...##...##

Tile 1277:
..####.##.
..........
...#...#.#
......#...
#..#.#...#
.#...#...#
##....#.##
..#.....##
#.......#.
#.....##..

Tile 2659:
##...#...#
..#....###
.#.#..#..#
....#.##..
.....#...#
#.#.......
..........
....##..##
..........
.#..####.#

Tile 3673:
..###..#..
..#.......
..........
##....#.#.
....#..#..
...#......
#..#...#.#
......#...
..##.#...#
#.##......

Tile 3329:
#....#..#.
#....#...#
##.#.....#
.......#.#
#..##.#.#.
#...##....
##.#.##...
#........#
.#...##.#.
.####...#.

Tile 2383:
#...####.#
##......##
.......###
#.........
..#..#..##
.#.####.#.
.#..##...#
#.#..#....
..#.#..#.#
......####

Tile 2377:
...#....#.
....#..#.#
.#.......#
#....##...
..#.####..
#.......#.
.......#..
....#...##
.......#..
##..#..#..

Tile 1931:
###.#...##
...##...##
.#.#..#.#.
#...#.##.#
.........#
##........
...#..#...
......#.#.
#...#...##
##..#..#..

Tile 3911:
#..####...
...##..#..
##.....#..
###.....##
..........
...#..##.#
#......###
#.#....#.#
#..#.###.#
.....#####

Tile 3251:
##.##.#.#.
#....#.#..
#....#...#
#.#...#.#.
#.......##
..#....#..
..##...#..
.#.#..#..#
..#.#..#.#
#..#......

Tile 1879:
##.#.#.###
...#...#.#
.#.#.#....
#..#.##..#
#.......##
#........#
..##......
.#.....#.#
...#....##
.###.#.###

Tile 2819:
#.#....###
..#....##.
#.#.......
..#.#..#.#
.#.#......
#...#.....
.#...#....
.#..#.##..
.###..#.##
...##.#.##

Tile 2351:
..#..##.#.
#.#....#..
#.##...##.
........##
#....#....
...#....#.
#.#.##....
.##.#.##.#
.##.......
###..#..##

Tile 2801:
#.#....#..
#......##.
.#..#..#..
....#...##
....##.#..
##........
#.##.#.#..
.##...#...
..........
###..##.#.

Tile 1873:
#.#.....##
#........#
#........#
.#........
........#.
......#.#.
...#......
....#.....
#.#.......
#.#...#..#

Tile 2437:
###.##..#.
#.##..##..
..#.#...##
#.....##.#
##.......#
....#..#..
#..##...#.
..#.##....
......##..
..##..#...

Tile 2579:
#..##.####
##.#...#.#
.##..#...#
##.....#..
###.......
#....#....
#..#.#...#
#...#...##
.#.#....##
#.#..#....

Tile 1609:
.#..##.##.
#..##....#
#....#..##
#....#.###
#.####....
##..##.#..
..#.#...#.
...##....#
#...##...#
##..#..###

Tile 3929:
..###...##
##........
##.##....#
..#..#.#..
..#.#....#
#.##..#...
.##......#
##.#.....#
#.......##
..##.##...

Tile 1487:
..####.#..
#.#.#...#.
.........#
#...#.....
#......#..
#......#.#
###......#
#..#.###..
.......#.#
#..##..###

Tile 1811:
..#....##.
..#.#...#.
.......#..
...#.#...#
#..##...#.
..........
#...#...##
....#....#
#.#...#...
.#.#..###.

Tile 1747:
#..##.#.#.
#..#......
..#.###..#
..#.#.....
#.##.....#
#........#
##...###..
...#...#..
..#.#..#.#
#..##.###.

Tile 3779:
#.#####...
...#.....#
..#.#....#
.#.#......
##.....##.
##.....###
#.##.#.###
.#.#.###.#
....#.....
......#...

Tile 3767:
.##.##.###
#.#.....#.
#...#..##.
###....##.
.....##...
..#.......
......#..#
....#..#..
#......#..
##..#.#...

Tile 1871:
.#.###...#
##...###..
#..#...###
......#..#
#....####.
#.#......#
..........
##......#.
..........
##..#.##.#

Tile 3803:
##..#.#..#
#........#
#.........
....#...#.
#.#...##.#
#..##.....
###...#...
#.##.#.#.#
...#####.#
#..#.#....

Tile 2441:
.##..#.#.#
.........#
#..#..#.##
#...#...##
.....#..#.
...#.#...#
#........#
..##.#.#.#
#....#...#
.#..#..###

Tile 3373:
..###.....
...##....#
#...##....
.#........
#.......#.
..#.......
...#.#...#
#.....##..
..........
#####.#...

Tile 1721:
###.....##
#.........
...#......
#.....#...
..#......#
#........#
#..#....#.
#.......#.
.#....#...
#.##....#.

Tile 3499:
####...#.#
...##....#
#...#..#..
...#......
#.....##..
.........#
.#.......#
.#..#...##
#..#...##.
.#######..

Tile 3851:
#.##.#....
#..#....##
.#.##....#
.........#
#..#.#..#.
.....#...#
#.#.#....#
#.....#..#
####.....#
######.#.#

Tile 1181:
...#..####
....#....#
#.......##
##........
.##....#.#
..#......#
#.....#..#
.....#..#.
#..####..#
..#####.##

Tile 2269:
##.#...###
..##.#.#.#
##......##
.....#...#
.#.......#
#.#..##..#
##........
.#........
##.....#..
.##......#

Tile 2903:
.#.#.###..
.#..#.#..#
........#.
..#....#..
#.....#...
......###.
#.#....#..
#.#.#.#...
#........#
###.##...#

Tile 2927:
.##..####.
#.......#.
#........#
#.....##.#
##........
..#.......
#.......##
.##..#.#..
.......#..
...#..#..#

Tile 2083:
#.##.#..##
...#...##.
.......##.
...#..#...
###..#...#
##.......#
###.#.....
...#......
.#..#....#
...###..##

Tile 1621:
#.###.###.
..........
......##..
#.#....#.#
.#.#.###.#
#.........
#......#.#
#.#.##....
#...##...#
.#####....

Tile 2797:
........##
#..#.....#
..........
###.....##
#........#
#.........
#....####.
...#.###.#
......#.##
#...#.#.#.

Tile 1433:
.##..#....
#.....#.#.
.#.......#
..#..#.#.#
....#.....
#.#.......
..#.#..##.
#....#.#..
.........#
..#.##..##

Tile 1259:
.###...#..
#..#..#.##
#..#.#....
##..##.###
#.#...#.##
.......#.#
#.#....#.#
.##..##..#
.##..#....
.######.#.

Tile 1657:
#..##..##.
..###....#
###.......
.##.#....#
#.......##
##.#......
..........
#.#.....##
..#..#....
.#.#..#.##

Tile 3323:
..##.#####
....##..#.
#.#......#
#....#..##
#..#.....#
##........
.###.##...
.#.....###
...#..#..#
.##..###..

Tile 2203:
##....##.#
#.#.#..#.#
...#.##...
#....#.#.#
#.........
.##..#...#
#.....#.#.
.##.#..#.#
.#...#...#
...###....

Tile 2477:
#######...
..#....#..
#.........
#.#.....##
#...##....
...#.....#
#......#..
......#...
####.#..##
.#....####

Tile 3343:
#.#####.#.
....#..#..
........##
..#.##....
.#..#....#
.....#....
#.#.#....#
...#....##
#.##.#...#
.#..##..##

Tile 3821:
#.##..#..#
.........#
.#........
........#.
..#.......
#.##......
#......#..
....###.#.
#..#......
#.#.#.....

Tile 3347:
####....#.
#.........
#...#.....
.#..#.....
.#.......#
....#..#.#
.#.#.....#
...#......
.....##..#
.#######..

Tile 3877:
.#.#.####.
.......#.#
#.......#.
#..#.#.#.#
..#.#.#...
##.......#
....#...#.
..##..#..#
##.##..#..
#..#...#.#

Tile 3739:
.##.###.#.
#.##.....#
#.........
....#....#
#....#....
.#.#......
.#......#.
...#......
.........#
##.#.##.#.

Tile 3257:
..##.###..
.....##.##
#..###..##
.......#..
....#.....
..##......
#.#......#
#....#....
#...##....
#..####.#.

Tile 2969:
#.#.......
..#......#
...#.....#
.#.......#
#..#......
#..#.....#
#.#....##.
..#.....##
#..#.#..#.
...##.#..#

Tile 1097:
#####...#.
#..####..#
.##.#.##.#
#.......##
##.......#
#...#..#.#
#.......##
.......#..
......#...
..#.#.##.#

Tile 2011:
#.##.....#
#....#..##
.....#....
..##.#...#
#...#.....
...##.##..
###.##..##
#.#.##...#
#....#...#
#.##..#.##

Tile 1399:
#####..#.#
.###.#...#
#......#.#
...#.#....
##..#.#.#.
......#.##
......#..#
#..#.#....
#.#...#..#
##..####.#

Tile 3449:
.###..#...
.###..#.#.
..........
#.......##
...#..####
##.......#
.....#.#.#
#.#..#.#.#
.#...#..#.
#.##.#...#

Tile 2897:
#.#.......
..##......
#..#....##
.#........
#.#...#...
...#....##
#.##..#...
..#.#.....
.#.#......
.##..#..##

Tile 1153:
....#.#...
#.##.##..#
..#.##.#.#
.#...#.#..
..#...#...
......#.##
.#.......#
#.....#.#.
.#...#...#
.....#...#

Tile 2789:
#...####.#
##.#.....#
.......#..
......#..#
......#..#
..#.....##
....##..##
#...#.#..#
##...#.#..
..##.#....

Tile 1637:
.....#.#..
..#..#...#
#.....#.##
.#..#.....
#..#.....#
..#.#.##.#
.......#.#
....#.....
##.#.....#
##..#...#.

Tile 2029:
.#.#...#..
#...##...#
#.....##.#
##...#.##.
#.#..#....
#.....#...
#.........
..........
.#.###.#..
.#...####.

Tile 2239:
.####..#..
...#...#.#
##..#....#
..........
..#......#
.#........
##........
..........
..........
#..#####.#

Tile 2663:
.#...#...#
....#.#...
#....#...#
..##..###.
#....##...
##........
.#...#..##
.........#
.#...##.#.
..#...#...

Tile 1567:
..###.##..
#...#..#..
#.#......#
#......#..
#.#..#..##
.#..#.#..#
#.......#.
#.#.#...#.
....#....#
..#.....##

Tile 2467:
.#########
#..#......
#.#.....#.
.....#..#.
#...#....#
###.......
##...#.#.#
...#.#..##
#.....##.#
#..##.#..#

Tile 1447:
.#####..#.
...#..#...
.#..#..#..
...#.#.#.#
.#........
..#.......
#.......#.
#.##..#...
.........#
#####.##.#

Tile 3863:
.#...##..#
.#..#..#..
.........#
#......#.#
#...##....
.#........
#..##..#..
....#..##.
#.......##
.##...##..

Tile 3761:
..#....###
#.........
.#....#.##
##.......#
.........#
#.........
...#...#..
#......#..
......##..
#...##....

Tile 2027:
.##.#.##..
#.....#.##
....#....#
....#.#...
#.....#.#.
....#.#...
####......
.....##...
......#..#
....#...##

Tile 1279:
..#.#####.
#.#....#..
#.......#.
#.....#...
.#........
......##.#
#......#..
#.......##
.#...#....
.####..#..

Tile 1997:
#.#.#...#.
......#..#
###.......
#.......#.
#..#......
..#...#..#
...##.....
...#......
..........
..##...##.

Tile 3049:
..##.##...
.......#..
#...#....#
#..#.#....
.#..#.#.#.
.#.##...##
......#...
#..#....#.
..........
##...#.###

Tile 3209:
##..###.##
.....#..#.
#.#.#...##
#.#...#.##
....#...#.
..#.......
#....#..##
###...#...
#......#.#
##.#...###

Tile 3719:
####.##..#
.........#
..#.......
#.#.......
.##....##.
#.....#..#
.#.#..##.#
#.#.#.....
##..#.#.#.
..#...##..

Tile 3217:
..##.####.
...#.....#
.#.......#
.......#..
#...#.#...
..#.#..#..
.##......#
#.........
....#...##
..##..##.#

Tile 1913:
######.#.#
##....#.#.
.........#
#.#.#.....
#..##.#..#
#.....##.#
........##
........#.
#.....#...
###..##..#

Tile 2729:
.###.#..#.
..#..#...#
#..#.#.#..
.#...#...#
#......#..
...#..##.#
..........
.#........
#.#...##.#
##.####.#.

Tile 3089:
#...#.#.#.
..###.##..
#.#...##..
#......##.
..#...###.
#........#
.###..##.#
#..#......
#...#..#.#
#..#####..

Tile 3923:
.......##.
##.......#
#...#.#.#.
.......#..
.#.......#
#......##.
#.#...#..#
.....#..#.
#.....#...
.#..##.###

Tile 3229:
##..####.#
.....#..#.
#.#..#..#.
..........
.....#....
.........#
#.#.#.##.#
#.#.......
.#.#...###
##..#.#.#.

Tile 1571:
###....##.
.#.#..###.
##....####
..#.#..#..
.....#....
.#....#..#
....#.##.#
#..#.###.#
..#.....#.
.##..###.#

Tile 1063:
####.#####
.#....#...
#......#.#
........##
..##...#.#
##....#..#
#...##.#..
###.......
#....#...#
####.####.

Tile 1663:
..###.####
.....##..#
..#...##..
#..#..#...
#.#.......
...##.....
#....#.#.#
#.#..##...
.......#..
#.###.##..

Tile 1987:
..#...#...
....#...##
.#...#...#
..........
.#....#.##
####....#.
......#...
........##
#.....##.#
....###.#.

Tile 2803:
.##.#.##.#
#.#.....#.
#..#....#.
....#.#..#
...#..#...
#.#..##..#
.#.##..##.
..#...#.#.
#.##.#....
.#.###..##

Tile 1699:
.#.##.##.#
#.#.......
##.##.....
......##..
.#....#..#
..........
.........#
#...#.....
...###.##.
#....#####

Tile 1999:
..#..##..#
#..###...#
....##...#
.#....#...
.........#
#...#.....
.........#
#....#..##
..........
..#...####

Tile 1733:
#....#..##
##..#....#
#....#...#
###.......
#..#...#.#
.....#...#
.#.......#
.#....#..#
..#.#.#.##
......####

Tile 2273:
#...#..###
.#.##.#..#
###..##..#
##....#...
.....#..#.
...#..#...
#..#.#...#
#.........
..##...#..
.###.#.#..

Tile 1493:
##.#...##.
#...#...##
..#......#
##..#.....
##........
....#.....
#......###
......#...
##.....#..
#.#.#.....

Tile 3637:
..##.#.#..
#..###...#
....#..##.
##......#.
##.#.#...#
..#...#..#
#...#.....
..#..##...
.....#..##
.#.##...##

Tile 2333:
##.#...#..
#......###
..#.....##
.##......#
...##.##..
#..#.#.#..
....#.##.#
...#...#.#
.###....#.
.#.#.##..#

Tile 1201:
..#.#.####
..#...##..
#..##....#
#.#...#...
.....#....
...#....#.
....#....#
...#......
.##..##.##
###.#..##.

Tile 2243:
#..######.
.........#
...#....##
#...#..#..
#..#....#.
.....##...
.....#.#..
#........#
.#....#.##
####.#.#.#

Tile 1667:
##...##..#
....##...#
##..#..###
.....#..##
#........#
..#......#
#....#..##
#.........
##....##..
#..###...#

Tile 2053:
#.##.####.
#..##..##.
......#.##
.....#...#
#.##...#..
###.##..##
###.#..#..
#..#...#.#
#.#.#..###
#.#..####.

Tile 3407:
.##......#
#........#
......#..#
...#.#..##
#....##...
#....#..##
#...#....#
....#.###.
..#...#..#
..##.##.#.

Tile 2687:
###.#..#.#
...#####.#
##.#.....#
##.#......
...##..##.
#...#....#
#.........
#.........
#........#
..##.#....

Tile 1973:
##..#.###.
###..#.##.
####.....#
#...#.....
#....#...#
##.#....#.
#.#.##.#.#
###..#.#.#
##......#.
.#.....#..

Tile 2693:
.##.....#.
....#....#
#.#.#..#..
.##...#..#
##......##
##.#.#.##.
.#....#..#
....##...#
.#......##
...#.#.#..

Tile 2141:
....#####.
.........#
...#.#..##
.......#.#
#...#.#...
..........
...#......
..#.#.#...
#.#.#....#
.......###

Tile 1163:
##.#.##.##
#.....#.#.
.#.###....
..#..#..#.
#......#.#
#.......#.
.#...#.#..
.#...#..##
...#....##
...#.....#

Tile 1091:
##.##...##
#.........
....#.....
#........#
#...#.##.#
##.##.#..#
.........#
.........#
......#.##
####...###

Tile 2281:
...##...#.
....#...##
#..#.#...#
..#.#.....
###......#
.#......##
#........#
.......###
.....#....
##.#.#.##.

Tile 2767:
.##...#..#
..........
..#....##.
#..##....#
..#....#..
...##.#..#
..#####..#
#...###.##
#....#...#
###.##.##.

Tile 1697:
..###.#.#.
#####..#.#
...#...#.#
#.##...###
#.#..##...
......#..#
.##...####
..###.#...
#.##...#.#
#.#...#.#.

Tile 1409:
.######...
.##.....##
#....#..#.
....#...##
#...#.#.##
#..#....##
#......#.#
#...#..#.#
#.##......
.###.#..#.

Tile 3001:
###....#..
##.#..#..#
####..#...
#......#..
.#.#...##.
..#.#.##.#
..#...#.#.
####..##..
.........#
#..#.##...

Tile 1321:
..####.#.#
.##.......
...##.....
#......##.
##..#.....
.........#
##.##...##
#.##......
...#.#...#
##.###.#..

Tile 2707:
###.#..##.
.#....##.#
#...#..##.
#....#....
#.........
#...#.....
.##..#....
#.#..#..##
##....####
..#.##.##.

Tile 2689:
#.#.##.##.
.#......##
#...#...#.
..#...#...
..#......#
..#.#.##..
..........
....#.....
#........#
.#.#.####.

Tile 2551:
.........#
.#.......#
#..###...#
.#.#......
.........#
.#........
#..#....##
.#####....
#........#
.###..##..

Tile 1831:
##.#.#####
...#...###
#..#....#.
.#..#...#.
###......#
##..#..##.
#..#.....#
..#......#
..##.....#
#.....#.#.

Tile 2423:
##.#.#....
..........
#.........
##......#.
#.##.....#
##..#....#
....###..#
####.#..#.
####..#...
.#.#..###.

Tile 1373:
.#..##.#..
...#..#...
#......#..
#.##..#.##
..#..#....
##......##
#....#....
##..###...
#....#.#.#
#...#.###.

Tile 1123:
##.#..#..#
#.....#.##
#..##.##.#
#....#...#
..#.#.....
##.##.....
#...#..#.#
#..#.#....
..........
.###......

Tile 2647:
..#.##.##.
#......#.#
........#.
#....####.
..........
##....#.##
...#......
....#.....
.##.....#.
.#...##.##

Tile 2557:
...#..###.
.....##...
....##..#.
..#..#.#..
##....#..#
#.......#.
##......##
#.#..###..
.#.#.##...
.###.##..#

Tile 2003:
#..#...#..
#.#......#
..#.#.....
#.......##
.....#....
.....#...#
....##.#..
......#..#
...##.#..#
##....#.##

Tile 1051:
#..#....##
#..#...###
.......###
...##..#.#
#...#.....
#......##.
#.......#.
..##....##
.......#.#
.#.##..###

Tile 3613:
..#.#..##.
....#...#.
##.....#..
...#....##
.##..#...#
..#.#..#..
##..#.....
##..##...#
......##.#
##.#.##.#.

Tile 3529:
.#..#.#.##
.#.##..#..
##..##...#
#...#....#
...#....##
#........#
.#...#...#
...##.#...
#....##..#
##.#.#.#.#

Tile 1291:
#.#.##...#
..#.....#.
#.....#...
##.###.##.
.#.#.#....
.#...##.#.
..#...#.#.
.....#..#.
#...#..#..
#..#.#..#.

Tile 3023:
..#.#..#..
#...###...
.#.......#
.#..#.....
##........
.......#.#
#.......##
.....#...#
#.##......
.#.######.

Tile 1307:
##.###.##.
#.#..#....
.#....#...
#.#.....#.
...#.....#
....#.#...
#........#
##....#...
...#......
.#.##.....

Tile 1301:
###.####.#
.....#....
..#..#.#..
..##..#..#
#.#.#....#
.#...#..##
#....#..#.
.#.###....
.##.#..#.#
...####..#

Tile 3769:
#.#.....#.
.........#
...##...#.
......##..
#........#
#...#.....
.#..#..###
....#...#.
#......#.#
###....#.#

Tile 3727:
..##.##.#.
.........#
...#.#...#
#..#.####.
#..#..#..#
#..#..##..
....##...#
#..#.#...#
...#......
.#.#.##.##

Tile 2851:
..#...##.#
.#.##.#...
##.....#.#
..##.#...#
##....#..#
#..#..##.#
#.##.#.###
.....##...
...#.#....
..##..####

Tile 1787:
.#..#....#
#..#.#...#
#........#
.......#..
...#.....#
#.....#..#
#..#....##
#.....#.##
##.......#
....###..#

Tile 2957:
#.##..#..#
#..#.##.#.
.......#..
..##.##...
...#.....#
.##....#..
...#...#..
.#.##..##.
#..#......
...#.##.#.

Tile 1453:
.#..#.....
#..#......
.#......#.
##..#.#..#
......#...
#####...##
##...#..#.
#.....#.##
.....###..
####.#....

Tile 1549:
.###......
......#..#
#..#.#.#.#
##...#....
#.#.##..#.
#...#...##
........#.
##....#..#
.#...###..
##.##..###"""

    visited = set()
    iters = 0
    tile_borders = {}
    adj_tiles = {}
    all_tiles = {}
    flipped = set()

    def flip_borders(self, nr):
        self.tile_borders[nr] = [border[::-1] for border in self.tile_borders[nr]]

    def create_adjacent_tiles(self):
        for nr in self.tile_borders:
            tile = self.tile_borders[nr]
            for border_i, border in enumerate(tile):
                for adj_nr in self.tile_borders:
                    if adj_nr == nr:
                        continue
                    adj_tile = self.tile_borders[adj_nr]
                    for adj_border_i, adj_border in enumerate(adj_tile):
                        if border == adj_border or border == adj_border[::-1]:
                            if nr in self.adj_tiles:
                                self.adj_tiles[nr].append((adj_nr, [border_i, adj_border_i]))
                            else:
                                self.adj_tiles[nr] = [(adj_nr, [border_i, adj_border_i])]
                            continue

    def __init__(self):
        inp = self.input.split('\n\n')
        for i in inp:
            nr = i.split('\n')[0].split(' ')[1][:-1]
            tile = i.split('\n')[1::]

            borders = []
            image_part = tile.copy()
            for _ in range(4):
                image_part.pop(0)
                borders.append(list(tile[0]))
                tile = list(zip(*tile))[::-1]
                image_part = list(zip(*image_part))[::-1]
            self.tile_borders[nr] = borders
            self.all_tiles[nr] = image_part

        self.create_adjacent_tiles()

        image = [[0 for _ in range(12)] for _ in range(12)]
        start_tile_nr = None
        for nr in self.adj_tiles:
            tile = self.adj_tiles[nr]
            nr_of_adjacent = len(tile)
            if nr_of_adjacent == 2:
                start_tile_nr = nr
                break

        self.generate_full_image(image, (0, 0), 0, start_tile_nr, False)

        full = []
        full_flipped = []
        total_squares = 0
        for tiles_row_i, tiles_rows in enumerate(image):
            for tile_row in range(0, 8):
                row = ""
                for tile in tiles_rows:
                    row = row + ''.join(tile[tile_row])
                full.append(row)
                full_flipped.append(row[::-1])
                total_squares += row.count('#')

        nr_of_mons = 0
        cands = [full, full_flipped]

        rot = full.copy()
        rot_flip = full_flipped.copy()
        for i in range(3):
            rot = list(zip(*rot))[::-1]
            rot_flip = list(zip(*rot_flip))[::-1]
            cands.append(rot.copy())
            cands.append(rot_flip.copy())

        while nr_of_mons == 0:
            for im_i, im in enumerate(cands):
                for ri, row in enumerate(im):
                    if ri == 94:
                        break
                    for pi, _ in enumerate(row):
                        if pi == 76:
                            break
                        r1 = self.matches_row(im, ri, pi, [18])
                        r2 = self.matches_row(im, ri + 1, pi, [0, 5, 6, 11, 12, 17, 18, 19])
                        r3 = self.matches_row(im, ri + 2, pi, [1, 4, 7, 10, 13, 16])
                        if r1 and r2 and r3:
                            nr_of_mons += 1

        print(total_squares - (nr_of_mons * 15))

    def matches_row(self, image, row_i, pi, offset):
        match = True
        for o in offset:
            match &= (image[row_i][pi + o] == '#')
        return match

    def get_rot(self, cur_rot, side, adj_side, flipped, adj_flipped):
        a = [0, 1, 2, 3]
        b = [0, 3, 2, 1]
        if not flipped and adj_flipped:
            return (b[((a[side] + 2 - cur_rot) % 4)] - adj_side) % 4
        elif not flipped and not adj_flipped:
            return (adj_side - side + cur_rot + 2) % 4
        elif flipped and adj_flipped:
            return (side - adj_side + cur_rot + 2) % 4
        elif flipped and not adj_flipped:
            return (adj_side - a[(b[side] + 2 - cur_rot) % 4]) % 4

    def generate_full_image(self, image, image_index, cur_rot, nr, flipped):
        if nr in self.visited:
            return
        self.visited.add(nr)

        nr_of_adj = len(self.adj_tiles[nr])
        image_tile = self.all_tiles[nr].copy()
        if flipped:
            image_tile = np.flip(image_tile, 1).tolist()
        for _ in range(cur_rot):
            image_tile = list(zip(*image_tile))[::-1]
        image[image_index[1]][image_index[0] * -1] = np.flip(image_tile, 1).tolist()

        for i in range(nr_of_adj):
            a = self.adj_tiles[nr][i]
            flip_next = False
            adj_tile_nr = a[0]
            side = a[1][0]
            adj_side = a[1][1]
            border = self.tile_borders[nr][side]
            adj_border = self.tile_borders[adj_tile_nr][adj_side]

            if border == adj_border:
                flip_next = True
                self.flip_borders(adj_tile_nr)

            rot = self.get_rot(cur_rot, side, adj_side, flipped, flip_next)

            d = {0: [0, -1], 1: [1, 0], 2: [0, 1], 3: [-1, 0]}
            d_flipped = {0: [0, -1], 1: [-1, 0], 2: [0, 1], 3: [1, 0]}
            if flipped:
                next_dir = d_flipped[(side + cur_rot) % 4]
            else:
                next_dir = d[(side - cur_rot) % 4]

            next_x = image_index[0] + next_dir[0]
            next_y = image_index[1] + next_dir[1]

            self.generate_full_image(image, (next_x, next_y), rot, adj_tile_nr, flip_next)


Day20_1()
